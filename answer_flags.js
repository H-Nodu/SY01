// 答えが明らかに間違っている可能性がある問題にフラグを付与
// ランタイムで各問題オブジェクトに answer_flag プロパティを追加
(function() {
    const flags = [
        // =============================================
        // === 元の711問 (data.js) ===
        // =============================================

        // Q1-250
        {
            dataset: 'main', num: 32,
            note: '正しい答えはC（ファイアウォール）の可能性が高い。C2通信の宛先IPを特定するにはファイアウォールログが標準的。アプリケーションログにはネットワーク宛先情報は通常含まれない。'
        },
        {
            dataset: 'main', num: 116,
            note: '正しい答えはD（ホストベースのコンテンツフィルタリング）の可能性が高い。Always-On VPN障害時にはVPNに依存しないローカルのフィルタリングが必要。オンプレミスプロキシをNATで公開するのはセキュリティリスクが高い。'
        },
        {
            dataset: 'main', num: 150,
            note: '正しい答えはC（ユーザープロビジョニング）の可能性が高い。多数のアカウントの権限更新を自動化するのはプロビジョニングの役割。フェデレーションは組織間のSSO連携であり、権限の自動更新ではない。'
        },
        {
            dataset: 'main', num: 188,
            note: '正しい答えはD（ウォームサイト）の可能性が高い。コールドサイトはハードウェア設置・設定から必要で復旧に数週間かかる。RTO/RPO約2日を達成するにはハードウェアが事前設置されたウォームサイトが適切。'
        },

        // Q251-500
        {
            dataset: 'main', num: 321,
            note: '正しい答えはA（未使用のネットワークサービスを無効化）の可能性が高い。攻撃対象領域の削減には不要なサービスの無効化が最も効果的。デフォルトパスワードの変更はハードニングだが攻撃対象領域自体は減らない。'
        },
        {
            dataset: 'main', num: 349,
            note: '正しい答えはA（可用性）の可能性が高い。DDoS攻撃はサービスの可用性を標的とする。DDoS対策は完全性（整合性）ではなく可用性を守るためのもの。'
        },
        {
            dataset: 'main', num: 375,
            note: '正しい答えはC（NDA/秘密保持契約）の可能性が高い。知的財産の無断共有を防ぐにはNDAが必要。MOA/MOUは提携の条件を定めるものであり、機密情報の開示制限に特化していない。'
        },
        {
            dataset: 'main', num: 421,
            note: '正しい答えはA（MSA/マスターサービス契約）の可能性が高い。複数の年間契約にわたる共通条件を設定するのはMSAの役割。NDAは機密保持のみをカバーする。'
        },
        {
            dataset: 'main', num: 437,
            note: '正しい答えはC（SASE）の可能性が高い。フルリモートワーカー向けの統合ファイアウォール＋VPN＋高冗長性を提供するのはSASE。SIEMはログ分析ツールでありファイアウォールやVPN機能はない。'
        },
        {
            dataset: 'main', num: 440,
            note: '正しい答えはC（独立監査）の可能性が高い。コントロールが適切に設計・運用されていることを保証するのは監査の役割。脆弱性評価は技術的な脆弱性を特定するだけで、コントロールの設計・運用の有効性は評価しない。'
        },
        {
            dataset: 'main', num: 469,
            note: 'トークン化（C）はノートPC再発行には不適切。正しい2つ目の答えはA（データ保持）またはD（分類）の可能性が高い。サニタイズ（E）は正しいが、トークン化はデータベースや決済システム向けの技術。'
        },

        // Q501-711
        {
            dataset: 'main', num: 502,
            note: '正しい答えはB（CRL）の可能性が高い。証明書の失効状態を「受動的に」確認するのはCRL（定期的にダウンロードしたリストをローカルで参照）。OCSPはリアルタイムで問い合わせる能動的な方法。'
        },
        {
            dataset: 'main', num: 520,
            note: '正しい答えはD（ECC/楕円曲線暗号）の可能性が高い。限られた計算リソースに適した暗号化方式はECC。PKIは暗号化方式ではなく証明書管理の基盤フレームワーク。'
        },
        {
            dataset: 'main', num: 553,
            note: '正しい答えはA（ハニートークン）の可能性が高い。データベース内の偽ユーザーアカウントはハニートークン（おとりデータ）の典型例。ハニーポットはシステム全体を模倣したもの。'
        },
        {
            dataset: 'main', num: 571,
            note: '正しい答えはD（ACL）の可能性が高い。ネットワーク共有のデータ削除や不適切な権限を追跡・解決するにはACL（アクセス制御リスト）が適切。終了（Termination）は技術的な解決策ではない。'
        },
        {
            dataset: 'main', num: 628,
            note: '正しい答えはE（SLE）。問題の詳細解説でも「正解はE（SLE）です」と明記されており、答えフィールドD（FTA）は入力ミス。SLEはリスク移転コスト比較の指標。'
        },
        {
            dataset: 'main', num: 636,
            note: '正しい答えはD（ウォームサイト）の可能性が高い。問題文に「ハードウェアとインターネットアクセスを含む」とあるが、コールドサイトにはハードウェアは含まれない。ハードウェアが事前設置されているのはウォームサイト。'
        },
        {
            dataset: 'main', num: 710,
            note: '正しい答えはD（NIPS）の可能性が高い。外部攻撃からの「保護」にはIPS（防止）が必要。IDS（検知）は検出・通知のみで攻撃をブロックしない。'
        },

        // =============================================
        // === V22 新規問題 ===
        // =============================================
        {
            dataset: 'v22', num: 67,
            note: '正しい答えはD（ゲーミフィケーション）の可能性が高い。従業員にインセンティブを与える仕組みはゲーミフィケーションの特徴であり、CBT（コンピュータベーストレーニング）ではない。'
        },
        {
            dataset: 'v22', num: 80,
            note: '正しい答えはA（データ保持）とE（サニタイズ）の可能性が高い。退職者のノートPC再発行時にトークン化は不適切。データ保持ポリシーに従いデータを保全し、その後サニタイズするのが正しい手順。'
        },

        // =============================================
        // === V21 削除問題 ===
        // =============================================
        {
            dataset: 'v21', num: 54,
            note: '正しい答えはA（ホットサイト）の可能性が高い。UPSは数分〜数時間の短時間バックアップのみ。長時間の停電にはホットサイトや発電機が必要。'
        },
        {
            dataset: 'v21', num: 158,
            note: '正しい答えはA（最近解雇されたDBAを確認する）の可能性が高い。特定日時にデータベースバックアップスクリプトに不審なコードが仕込まれた状況は、ロジックボム（内部犯行）の典型的なシナリオ。'
        },
        {
            dataset: 'v21', num: 205,
            note: '正しい答えはC（音声認証＋指紋認証＋SMS OTP）の可能性が高い。問題文でサードパーティアプリケーション不可と明記されているが、モバイルOTPアプリはサードパーティアプリに該当する。'
        },
        {
            dataset: 'v21', num: 263,
            note: '正しい答えはC（リーガルホールド）の可能性が高い。改ざん防止形式でメールを保全する行為はリーガルホールド（法的保全）であり、取得（Acquisition）はフォレンジック証拠のコピー作成プロセスを指す。'
        },
    ];

    function applyFlags(questions, dataset) {
        if (!questions) return;
        flags.filter(f => f.dataset === dataset).forEach(f => {
            const q = questions.find(q => q.num === f.num);
            if (q) q.answer_flag = f.note;
        });
    }

    if (typeof QUESTIONS !== 'undefined') applyFlags(QUESTIONS, 'main');
    if (typeof QUESTIONS_V22_NEW !== 'undefined') applyFlags(QUESTIONS_V22_NEW, 'v22');
    if (typeof QUESTIONS_V21_ONLY !== 'undefined') applyFlags(QUESTIONS_V21_ONLY, 'v21');
})();
